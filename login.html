<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Sample FirebaseUI App</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>
    <script type="text/javascript">
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDoOkqPqY8bu68SFTBAkxof3DTqeyDUHBI",
            authDomain: "mood-shaker.firebaseapp.com",
            databaseURL: "https://mood-shaker.firebaseio.com",
            storageBucket: "mood-shaker.appspot.com",
            messagingSenderId: "243141168442"
        };

        // Init db app and create handle
        firebase.initializeApp(config);
        var database = firebase.database();

        // signInWithPopup
        var provider = new firebase.auth.FacebookAuthProvider();
        // provider.addScope('user_birthday');
        firebase.auth().signInWithPopup(provider).then(function(result) {
            // This gives you a Facebook Access Token. You can use it to access the Facebook API.
            console.log(result)
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            
            database.ref("/users").set({
                user: user,
                token: token
            });

        }).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // ...
        });

        // SignOut
        $("button.signOut").on("click", function() {
            firebase.auth().signOut().then(function() {
                // Sign-out successful.
                // redirect to splash page to login again
            }, function(error) {
                // An error happened.
            });
        })
    </script>
</head>

<body>
    <!-- The surrounding HTML is left untouched by FirebaseUI.
         Your app may use that space for branding, controls and other customizations.-->
    <h1 style="text-align: center;">Welcome to My Awesome App</h1>
    <div id="firebaseui-auth-container"></div>
    <button class="signOut">Sign Out</button>


    <script type="text/javascript">
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                  $("button.signOut").hide();
            } else {
                  $("button.signOut").hide();
            }
        });
    </script>
</body>

</html>
