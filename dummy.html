<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>MoodShaker</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
</head>

<body>

    <audio src=""></audio>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script id="player-script">
        // class mood-style -- data-name is the mood
        // Favorites button "add-to-favorites"
        var player = document.querySelector("audio");
        var songs = [];
        var count = songs.length;

        // call this on mood-button click
        function getSong(mood) {
            var format = "json";
            var moodName = mood;
            var client_id = "56d30c95"; // FIXME Change this when you get the key

            $.ajax({
                    url: "https://api.jamendo.com/v3.0/playlists/tracks/?client_id=" + client_id + "&format=json&limit=5&name=" + moodName,
                    method: 'GET'
                })
                .done(function(response) {
                    var data = response.results[0];
                    var tracks = data.tracks;

                    //blow away old songs
                    songs = [];

                    for (t in tracks) {
                        songs.push(tracks[t].audio);
                    }
                    // console.log(data, tracks);
                    console.log(songs);
                    playSong(songs[0]);
                });
        }

        function playSong(song) {
            player.setAttribute("src", song);
            player.play();
        }

        function stopSong() {
            player.pause()
        }

        function nextSong() {
            count += 1;
            if (count > songs.length) {
                count = 0;
            }
            let next = songs[count];
            console.log(next);
            playSong(next);
            console.log(count);
        }
    </script>
</body>

</html>
